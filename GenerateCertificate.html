<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generate Certificate â€” CINCO Academy</title>
  <link rel="icon" href="CincoLogo.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.17/interact.min.js"></script>
  <style>
    :root {
      --bg: #F3F4F6;
      --card: #FFFFFF;
      --primary: #6D28D9;
      --primary-700: #5B21B6;
      --accent: #EDE9FE;
      --text: #1F2937;
      --muted: #6B7280;
      --success: #10B981;
      --danger: #EF4444;
      --radius: 12px;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    .certificate-container {
      position: relative;
      width: 800px;
      height: 600px;
      margin: 0 auto;
      overflow: hidden;
    }

    .certificate-template {
      width: 100%;
      height: 100%;
      background-image: url('Cinco_Certificate_Template.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      position: relative;
    }

    .draggable {
      position: absolute;
      cursor: move;
      padding: 5px;
      border: 1px dashed transparent;
      z-index: 10;
      user-select: none;
      text-align: center;
    }

    .draggable:hover {
      border: 1px dashed #6D28D9;
    }

    .draggable.selected {
      border: 2px solid #6D28D9;
      background-color: rgba(109, 40, 217, 0.1);
    }

    .controls-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      z-index: 100;
      width: 250px;
      /* Make the panel independently scrollable so users can access all controls
         without scrolling the main page. Keeps the panel within the viewport. */
      max-height: calc(100vh - 40px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* smooth scrolling on touch devices */
    }

    .controls-panel h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: var(--primary);
    }

    .control-group {
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 1px solid var(--accent);
    }

    .control-group:last-child {
      border-bottom: none;
    }

    .control-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px 0;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .control-btn:hover {
      background: var(--primary-700);
    }

    .control-label {
      display: block;
      margin-bottom: 5px;
      color: var(--text);
      font-size: 14px;
    }

    .control-input {
      width: 100%;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 8px;
    }

    .control-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .control-row .control-btn {
      flex: 1;
    }

    .color-picker {
      width: 100%;
      height: 35px;
      padding: 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }

    .range-input {
      width: 100%;
      margin: 5px 0;
    }

    .font-select {
      width: 100%;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 8px;
      background-color: white;
    }

    .text-align-group {
      display: flex;
      gap: 5px;
    }

    .text-align-btn {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--primary);
      background: white;
      color: var(--primary);
      border-radius: 4px;
      cursor: pointer;
    }

    .text-align-btn.active {
      background: var(--primary);
      color: white;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© */
    .alignment-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      margin-top: 10px;
    }

    .alignment-cell {
      width: 100%;
      aspect-ratio: 1;
      border: 1px solid var(--primary);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.2s;
    }

    .alignment-cell:hover {
      background: var(--accent);
    }

    .alignment-cell.active {
      background: var(--primary);
      color: white;
    }

    .hint-text {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      text-align: center;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
    .draggable.selected::after {
      content: 'âœ';
      position: absolute;
      top: -20px;
      right: -20px;
      background: var(--primary);
      color: white;
      padding: 4px;
      border-radius: 50%;
      font-size: 12px;
      pointer-events: none;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: 'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background-image: url('CincoBackground.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      width: 100%;
      margin: 40px auto;
      padding: 0 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 30px;
      backdrop-filter: blur(10px);
    }

    .header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
    }

    .logo {
      background-color: var(--text);
      width: 80px;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
    }

    .title-container {
      flex: 1;
    }

    h1 {
      margin: 0;
      color: var(--primary);
      font-size: 28px;
    }

    .subtitle {
      color: var(--muted);
      margin: 4px 0 0;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text);
    }

    input,
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: inherit;
      font-size: 16px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--accent);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-700);
    }

    .btn-secondary {
      background: var(--accent);
      color: var(--primary);
    }

    .btn-secondary:hover {
      background: #ddd1fb;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .nav-link {
      color: var(--primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .nav-link:hover {
      text-decoration: underline;
    }

    #certificateOutput {
      display: none;
      margin-top: 20px;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: var(--radius);
      background: white;
    }

    /* Add styles for the download button */
    .download-btn {
      background: var(--primary);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 20px;
      transition: background-color 0.2s;
    }

    .download-btn:hover {
      background: var(--primary-700);
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .container {
        margin: 20px auto;
      }
    }

    /* Custom scrollbar for the controls panel */
    .controls-panel::-webkit-scrollbar {
      width: 8px;
    }

    .controls-panel::-webkit-scrollbar-track {
      background: transparent;
    }

    .controls-panel::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.12);
      border-radius: 6px;
    }

    /* Firefox scrollbar settings */
    .controls-panel {
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.12) transparent;
    }

    /* Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© */
    .alignment-guide {
      position: absolute;
      background-color: rgba(109, 40, 217, 0.3);
      pointer-events: none;
      z-index: 1000;
      transition: opacity 0.2s;
    }

    .alignment-guide.vertical {
      width: 1px;
      height: 100%;
      top: 0;
    }

    .alignment-guide.horizontal {
      height: 1px;
      width: 100%;
      left: 0;
    }

    .alignment-guide.center {
      background-color: rgba(241, 89, 37, 0.5);
    }

    .alignment-guide-label {
      position: absolute;
      background: rgba(47, 90, 130, 0.9);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <img class="logo" src="CincoLogo.png" alt="CINCO Academy logo">
        <div class="title-container">
          <h1>Certificate Details</h1>
          <p class="subtitle">Fill in the information to generate a certificate</p>
        </div>
      </div>

      <form id="certificateForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="studentName">Student Name *</label>
            <input type="text" id="studentName" placeholder="Enter student name" required>
          </div>

          <div class="form-group">
            <label for="scoreResult">Score / Result *</label>
            <input type="text" id="scoreResult" placeholder="Enter score/result" required>
          </div>

          <div class="form-group">
            <label for="courseName">Course Name *</label>
            <select id="courseName" required>
              <option value="" disabled selected>Select a course</option>
              <option>Machine Learning</option>
              <option>Artificial Intelligence</option>
              <option>ReactJS</option>
              <option>Data Science</option>
              <option>Database Diploma</option>
              <option>Programming Concepts</option>
              <option>Flutter Mobile App</option>
            </select>
          </div>

          <div class="form-group">
            <label for="certificateId">Certificate ID / Batch (Auto-generated)</label>
            <input type="text" id="certificateId" placeholder="Auto-generated" readonly>
          </div>

          <div class="form-group">
            <label for="instructorName">Instructor Name *</label>
            <input type="text" id="instructorName" placeholder="Enter instructor name" required>
          </div>

          <div class="form-group">
            <label for="studentEmail">Student Email</label>
            <input type="email" id="studentEmail" placeholder="Enter student email">
            <div id="emailError" style="color: var(--danger); font-size: 14px; margin-top: 5px;"></div>
          </div>

          <div class="form-group">
            <label for="hrRepresentative">HR Representative *</label>
            <input type="text" id="hrRepresentative" placeholder="Enter hr representative" required>
          </div>

          <div class="form-group">
            <label for="certificateDate">Certificate Date *</label>
            <input type="date" id="certificateDate" required>
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notes / Comments</label>
          <textarea id="notes" placeholder="Enter any additional notes or comments"></textarea>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">Generate Certificate</button>
          <button type="reset" class="btn btn-secondary">Reset Form</button>
        </div>
      </form>

      <div class="navigation">
        <a href="index.html" class="nav-link">â† Back to Home</a>
        <a href="GenerateRecipt.html" class="nav-link">Generate Receipt â†’</a>
      </div>
    </div>
    <div id="certificateOutput">
      <!-- Certificate content will be dynamically generated here -->
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù†ØµÙˆØµ -->
    <div class="controls-panel" id="controlsPanel" style="display: none;">
      <h3>Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…
        <button id="helpBtn"
          style="float: left; background: none; border: none; cursor: pointer; color: #0031ae; font-size: 16px;"
          title="Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚">ğŸ¤– Ø§Ø¶Ø¹Ø· Ù‡Ù†Ø§ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ø±Ø´Ø§Ø¯Ø§Øª</button>
      </h3>

      <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
      <div id="helpDialog" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
           background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
           z-index: 1000; max-width: 400px; font-size: 14px; direction: rtl;">
        <div style="position: relative;">
          <h4 style="margin-top: 0; color: #6D28D9;">Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚</h4>
          <button onclick="this.parentElement.parentElement.style.display='none'" style="position: absolute; top: 0; left: 0; background: none; border: none; 
                         cursor: pointer; font-size: 18px; color: #666;">âœ•</button>
          <ul style="padding-right: 20px; margin: 10px 0;">
            <li>Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§:
              <ul>
                <li>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: 28 Ø¨ÙƒØ³Ù„</li>
                <li>Ø§Ù„Ù…Ø¯Ø±Ø¨ ÙˆÙ…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©: 16 Ø¨ÙƒØ³Ù„</li>
                <li>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©: 10 Ø¨ÙƒØ³Ù„</li>
              </ul>
            </li>
            <li>Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§:
              <div style="margin: 8px 0;">
                <div
                  style="display: inline-block; width: 20px; height: 20px; background: #f15925; vertical-align: middle;">
                </div>
                <span style="margin-right: 8px;">#f15925</span>
              </div>
              <div style="margin: 8px 0;">
                <div
                  style="display: inline-block; width: 20px; height: 20px; background: #2f5a82; vertical-align: middle;">
                </div>
                <span style="margin-right: 8px;">#2f5a82</span>
              </div>
            </li>
            <li>Ø§Ù„Ø®Ø· Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡: Cairo</li>
            <li>Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ: Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡</li>
          </ul>
        </div>
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø· -->
      <div class="control-group">
        <label class="control-label">Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø­Ø¬Ù…</label>
        <select class="font-select" id="fontFamily">
          <option value="Cairo" selected>Cairo</option>
          <option value="Tajawal">Tajawal</option>
          <option value="Almarai">Almarai</option>
          <option value="Arial">Arial</option>
        </select>
        <div class="control-row">
          <button class="control-btn" id="increaseFont">+</button>
          <input type="number" class="control-input" id="fontSize" min="8" max="72" step="1">
          <button class="control-btn" id="decreaseFont">-</button>
        </div>
        <div class="control-row">
          <button class="control-btn" id="boldText">Ø®Ø· Ø¹Ø±ÙŠØ¶</button>
          <button class="control-btn" id="italicText">Ø®Ø· Ù…Ø§Ø¦Ù„</button>
        </div>
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ© -->
      <div class="control-group">
        <label class="control-label">Ø§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©</label>
        <input type="color" class="color-picker" id="textColor">
        <label class="control-label">Ø§Ù„Ø´ÙØ§ÙÙŠØ©</label>
        <input type="range" class="range-input" id="textOpacity" min="0" max="100" value="100">
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© -->
      <div class="control-group">
        <label class="control-label">Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ</label>
        <div class="text-align-group">
          <button class="text-align-btn" id="alignRight">âŒ›</button>
          <button class="text-align-btn" id="alignCenter">â‰¡</button>
          <button class="text-align-btn" id="alignLeft">âŒš</button>
        </div>
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ -->
      <div class="control-group">
        <label class="control-label">ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ</label>
        <div class="control-row">
          <button class="control-btn" id="addShadow">Ø¥Ø¶Ø§ÙØ© Ø¸Ù„</button>
          <button class="control-btn" id="removeShadow">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¸Ù„</button>
        </div>
        <label class="control-label">ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø­Ø±Ù</label>
        <input type="range" class="range-input" id="letterSpacing" min="-2" max="10" value="0">
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù†Øµ -->
      <div class="control-group">
        <label class="control-label">ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù†Øµ</label>
        <input type="range" class="range-input" id="textRotation" min="-180" max="180" value="0">
        <button class="control-btn" id="resetRotation">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªØ¯ÙˆÙŠØ±</button>
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ø¥Ø¹Ø§Ø¯Ø© -->
      <div class="control-group">
        <button class="control-btn" id="duplicateText">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
        <button class="control-btn" id="resetText">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
      </div>

      <!-- Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØµØ¯ÙŠØ± -->
      <div class="control-group">
        <button class="control-btn" id="exportPDF">ØªØµØ¯ÙŠØ± PDF</button>
        <button class="control-btn" id="exportPNG">ØªØµØ¯ÙŠØ± PNG</button>
      </div>
    </div>
  </div>
  <script>
    const studentEmailInput = document.getElementById('studentEmail');
    const emailError = document.getElementById('emailError');

    // Generate certificate ID on page load
    window.addEventListener('load', function () {
      generateCertificateId();
    });

    // Function to generate a unique certificate ID
    function generateCertificateId() {
      const randomNumber = Math.floor(1000000000 + Math.random() * 9000000000);
      document.getElementById('certificateId').value = 'CA.' + randomNumber;
    }

    studentEmailInput.addEventListener('blur', function () {
      const email = studentEmailInput.value;
      if (email && !validateEmail(email)) {
        emailError.textContent = 'Please enter a valid email address.';
      } else {
        emailError.textContent = '';
      }
    });

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(String(email).toLowerCase());
    }

    document.querySelector('.btn-primary').addEventListener('click', function (e) {
      e.preventDefault();
      generateCertificate();
    });

    document.getElementById('certificateDate').valueAsDate = new Date();

    function generateCertificate() {
      const studentName = document.getElementById('studentName').value.trim();
      const scoreResult = document.getElementById('scoreResult').value.trim();
      const courseName = document.getElementById('courseName').value.trim();
      const certificateId = document.getElementById('certificateId').value.trim();
      const instructorName = document.getElementById('instructorName').value.trim();
      const hrRepresentative = document.getElementById('hrRepresentative').value.trim();
      const certificateDate = document.getElementById('certificateDate').value;

      const certificateOutput = document.getElementById('certificateOutput');
      certificateOutput.style.display = 'block';
      certificateOutput.innerHTML = `
      <div class="certificate-container">
        <div class="certificate-template" id="certContent">
          <div class="draggable" id="studentNameText" style="top: 250px; left: 300px; font-size: 28px; color: #6D28D9; font-weight: bold;">${studentName}</div>
          <div class="draggable" id="courseNameText" style="top: 300px; left: 300px; font-size: 22px; color: #1F2937;">${courseName}</div>
          <div class="draggable" id="scoreText" style="top: 350px; left: 300px; font-size: 18px;">Score: ${scoreResult}</div>
          <div class="draggable" id="instructorText" style="top: 400px; left: 150px; font-size: 16px;">Instructor: ${instructorName}</div>
          <div class="draggable" id="hrText" style="top: 430px; left: 150px; font-size: 16px;">HR: ${hrRepresentative}</div>
          <div class="draggable" id="certIdText" style="top: 400px; left: 500px; font-size: 16px;">ID: ${certificateId}</div>
          <div class="draggable" id="dateText" style="top: 430px; left: 500px; font-size: 16px;">Date: ${certificateDate}</div>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-primary" id="downloadCertificateBtn">Download Certificate</button>
      </div>
    `;

      // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      document.getElementById('controlsPanel').style.display = 'block';

      // ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø¹Ù†Ø§ØµØ±
      setupDraggableElements();

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
      setupControlButtons();

      // ØªÙØ¹ÙŠÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø¶ØºØ· Ù…Ø±ØªÙŠÙ†
      enableDoubleClickEditing();
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
      setupExportButtons(studentName, courseName);
    }

    // ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù„Ø¶ØºØ· Ù…Ø±ØªÙŠÙ† (Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù†ØµØ± ÙƒÙ„Ù‡)
    function enableDoubleClickEditing() {
      const certContent = document.getElementById('certContent');
      if (!certContent) return;

      // Ù…Ø³ØªÙ…Ø¹ Ù…Ø±ÙƒØ²ÙŠ Ù„Ù„Ø¶ØºØ· Ù…Ø±ØªÙŠÙ†
      certContent.addEventListener('dblclick', function (e) {
        const draggable = e.target.closest('.draggable');
        if (!draggable) return;

        const sel = window.getSelection();
        const selectedText = sel ? sel.toString().trim() : '';

        // Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ÙƒÙ„Ù…Ø© (dblclick Ø¹Ø§Ø¯Ø© ÙŠØ­Ø¯Ø¯ ÙƒÙ„Ù…Ø©) Ù†Ø¹Ø±Ø¶ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ ØµØºÙŠØ± ÙÙˆÙ‚Ù‡Ø§
        if (selectedText.length > 0) {
          try {
            const range = sel.getRangeAt(0).cloneRange();
            // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯
            if (!draggable.contains(range.commonAncestorContainer)) {
              // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ±ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†ØµØ± ÙƒÙƒÙ„
              makeElementEditable(draggable);
              return;
            }

            const rect = range.getBoundingClientRect();
            const input = document.createElement('input');
            input.type = 'text';
            input.value = selectedText;
            input.style.position = 'fixed';
            input.style.left = (rect.left - 2) + 'px';
            input.style.top = (rect.top - 2) + 'px';
            input.style.zIndex = 99999;
            input.style.padding = '4px 6px';
            input.style.fontSize = (window.getComputedStyle(draggable).fontSize || '16px');
            input.style.minWidth = Math.max(80, rect.width + 20) + 'px';
            input.style.border = '1px solid rgba(0,0,0,0.2)';
            input.style.borderRadius = '4px';
            input.style.background = 'white';

            document.body.appendChild(input);
            input.focus();
            input.select();

            const cleanup = () => {
              if (input && input.parentNode) input.parentNode.removeChild(input);
              sel.removeAllRanges();
            };

            const applyChange = () => {
              const newText = input.value;
              // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
              range.deleteContents();
              range.insertNode(document.createTextNode(newText));
              // Ø¯Ù…Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¹Ù‚Ø¯
              draggable.normalize();
              cleanup();
            };

            input.addEventListener('blur', applyChange);
            input.addEventListener('keydown', (ev) => {
              if (ev.key === 'Enter') {
                applyChange();
              } else if (ev.key === 'Escape') {
                cleanup();
              }
            });
          } catch (err) {
            // ÙƒØ­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠØŒ Ù†Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø§Ø¨Ù„Ø§Ù‹ Ù„Ù„ØªØ­Ø±ÙŠØ± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            makeElementEditable(draggable);
          }

        } else {
          // Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù…Ø­Ø¯Ø¯Ø© â€” Ù†Ø³Ù…Ø­ Ø¨ØªØ­Ø±ÙŠØ± Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø£ÙƒÙ…Ù„Ù‡
          makeElementEditable(draggable);
        }
      });

      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¤Ù‚ØªÙ‹Ø§
      function makeElementEditable(el) {
        if (!el) return;
        el.setAttribute('contenteditable', 'true');
        el.classList.add('selected');
        el.focus();

        // Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„
        const range = document.createRange();
        range.selectNodeContents(el);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);

        const finish = () => {
          el.removeAttribute('contenteditable');
          // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯
          const sel2 = window.getSelection();
          sel2.removeAllRanges();
          el.classList.remove('selected');
        };

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø£Ùˆ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter/Escape
        const onBlur = () => {
          finish();
          el.removeEventListener('blur', onBlur);
          document.removeEventListener('keydown', onKey);
        };

        const onKey = (ev) => {
          if (ev.key === 'Enter') {
            ev.preventDefault();
            finish();
          } else if (ev.key === 'Escape') {
            ev.preventDefault();
            finish();
          }
        };

        el.addEventListener('blur', onBlur);
        document.addEventListener('keydown', onKey);
      }
    }
    // ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø¹Ù†Ø§ØµØ±
    function setupDraggableElements() {
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© interact.js Ù„ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨
      document.querySelectorAll('.draggable').forEach(element => {
        interact(element).draggable({
          inertia: true,
          modifiers: [
            interact.modifiers.restrictRect({
              restriction: 'parent',
              endOnly: true
            })
          ],
          listeners: {
            move: dragMoveListener
          }
        });
      });
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø­Ø¨
    function dragMoveListener(event) {
      const target = event.target;
      // Ø§Ø­ØªÙØ¸ Ø¨Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ
      const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
      const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

      // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†ØµØ±
      target.style.transform = `translate(${x}px, ${y}px)`;

      // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      target.setAttribute('data-x', x);
      target.setAttribute('data-y', y);
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
    function setupControlButtons() {
      let selectedElement = null;

      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
      document.querySelectorAll('.draggable').forEach(element => {
        element.addEventListener('click', (e) => {
          // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
          document.querySelectorAll('.draggable').forEach(el => {
            el.classList.remove('selected');
          });
          // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ù‚ÙˆØ± Ø¹Ù„ÙŠÙ‡
          element.classList.add('selected');
          selectedElement = element;
          e.stopPropagation();

          // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
          updateControlValues(element);
        });
      });

      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†ØµÙˆØµ
      document.addEventListener('click', (e) => {
        if (!e.target.classList.contains('draggable') && !e.target.closest('.controls-panel')) {
          document.querySelectorAll('.draggable').forEach(el => {
            el.classList.remove('selected');
          });
          selectedElement = null;
        }
      });

      // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ¯ Ù†Øµ
      function updateControlValues(element) {
        const styles = window.getComputedStyle(element);
        document.getElementById('fontSize').value = parseInt(styles.fontSize);
        document.getElementById('textColor').value = rgbToHex(styles.color);
        document.getElementById('textOpacity').value = Math.round(styles.opacity * 100);
        document.getElementById('fontFamily').value = styles.fontFamily.split(',')[0].replace(/['"]/g, '');
        document.getElementById('letterSpacing').value = parseFloat(styles.letterSpacing) || 0;

        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
        document.querySelectorAll('.text-align-btn').forEach(btn => btn.classList.remove('active'));
        const textAlign = styles.textAlign;
        if (textAlign) {
          document.getElementById('align' + textAlign.charAt(0).toUpperCase() + textAlign.slice(1)).classList.add('active');
        }
      }

      // ØªØ­ÙˆÙŠÙ„ Ù„ÙˆÙ† RGB Ø¥Ù„Ù‰ Hex
      function rgbToHex(rgb) {
        const match = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
        if (!match) return '#000000';
        const r = parseInt(match[1]).toString(16).padStart(2, '0');
        const g = parseInt(match[2]).toString(16).padStart(2, '0');
        const b = parseInt(match[3]).toString(16).padStart(2, '0');
        return `#${r}${g}${b}`;
      }

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
      document.getElementById('fontSize').addEventListener('input', (e) => {
        if (selectedElement) {
          selectedElement.style.fontSize = e.target.value + 'px';
        }
      });

      document.getElementById('increaseFont').addEventListener('click', () => {
        if (selectedElement) {
          const input = document.getElementById('fontSize');
          input.value = parseInt(input.value) + 2;
          selectedElement.style.fontSize = input.value + 'px';
        } else {
          alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ø£ÙˆÙ„Ø§Ù‹');
        }
      });

      document.getElementById('decreaseFont').addEventListener('click', () => {
        if (selectedElement) {
          const input = document.getElementById('fontSize');
          input.value = parseInt(input.value) - 2;
          selectedElement.style.fontSize = input.value + 'px';
        } else {
          alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ø£ÙˆÙ„Ø§Ù‹');
        }
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·
      document.getElementById('fontFamily').addEventListener('change', (e) => {
        if (selectedElement) {
          selectedElement.style.fontFamily = e.target.value;
        }
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ
      document.getElementById('textColor').addEventListener('input', (e) => {
        if (selectedElement) {
          selectedElement.style.color = e.target.value;
        }
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ù†Øµ
      document.getElementById('textOpacity').addEventListener('input', (e) => {
        if (selectedElement) {
          selectedElement.style.opacity = e.target.value / 100;
        }
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ
      document.querySelectorAll('.text-align-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          if (selectedElement) {
            const align = btn.id.replace('align', '').toLowerCase();
            selectedElement.style.textAlign = align;
            document.querySelectorAll('.text-align-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          }
        });
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø­Ø±Ù
      document.getElementById('letterSpacing').addEventListener('input', (e) => {
        if (selectedElement) {
          let value = parseFloat(e.target.value);
          // Ø¶Ø¨Ø· Ù…Ù‚ÙŠØ§Ø³ ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ±
          if (selectedElement.id === 'studentNameText') {
            // ØªØ·Ø¨ÙŠÙ‚ Ù…Ù‚ÙŠØ§Ø³ Ø£ØµØºØ± Ù„Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„ÙƒØ¨ÙŠØ±
            value = value * 0.5; // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ù„Ù„Ù†Øµ Ø§Ù„ÙƒØ¨ÙŠØ±
          }
          selectedElement.style.letterSpacing = value + 'px';
        }
      });

      // Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¸Ù„
      document.getElementById('addShadow').addEventListener('click', () => {
        if (selectedElement) {
          selectedElement.style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
        }
      });

      document.getElementById('removeShadow').addEventListener('click', () => {
        if (selectedElement) {
          selectedElement.style.textShadow = 'none';
        }
      });

      // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù†Øµ
      document.getElementById('textRotation').addEventListener('input', (e) => {
        if (selectedElement) {
          const rotation = e.target.value;
          const currentTransform = selectedElement.style.transform;
          const translateMatch = currentTransform.match(/translate\((.*?)\)/);
          const translate = translateMatch ? translateMatch[0] : 'translate(0px, 0px)';
          selectedElement.style.transform = `${translate} rotate(${rotation}deg)`;
        }
      });

      document.getElementById('resetRotation').addEventListener('click', () => {
        if (selectedElement) {
          document.getElementById('textRotation').value = 0;
          const currentTransform = selectedElement.style.transform;
          const translateMatch = currentTransform.match(/translate\((.*?)\)/);
          const translate = translateMatch ? translateMatch[0] : 'translate(0px, 0px)';
          selectedElement.style.transform = translate;
        }
      });

      // Ù†Ø³Ø® Ø§Ù„Ù†Øµ
      document.getElementById('duplicateText').addEventListener('click', () => {
        if (selectedElement) {
          const clone = selectedElement.cloneNode(true);
          clone.style.top = (parseInt(selectedElement.style.top) + 30) + 'px';
          clone.style.left = (parseInt(selectedElement.style.left) + 30) + 'px';
          clone.id = selectedElement.id + '_copy';
          selectedElement.parentNode.appendChild(clone);
          setupDraggableElements(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        }
      });

      // Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±ÙŠØ¶ ÙˆØ§Ù„Ù…Ø§Ø¦Ù„
      document.getElementById('boldText').addEventListener('click', () => {
        if (selectedElement) {
          const currentWeight = window.getComputedStyle(selectedElement).fontWeight;
          selectedElement.style.fontWeight = (currentWeight === 'bold' || currentWeight >= 700) ? 'normal' : 'bold';
        }
      });

      document.getElementById('italicText').addEventListener('click', () => {
        if (selectedElement) {
          const currentStyle = window.getComputedStyle(selectedElement).fontStyle;
          selectedElement.style.fontStyle = currentStyle === 'italic' ? 'normal' : 'italic';
        }
      });

      // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†Øµ
      document.getElementById('resetText').addEventListener('click', () => {
        if (selectedElement) {
          selectedElement.style.transform = 'translate(0px, 0px)';
          selectedElement.setAttribute('data-x', 0);
          selectedElement.setAttribute('data-y', 0);
          selectedElement.style.fontWeight = 'normal';
          selectedElement.style.fontStyle = 'normal';
          selectedElement.style.textShadow = 'none';
          selectedElement.style.letterSpacing = 'normal';
          selectedElement.style.opacity = '1';
          selectedElement.style.textAlign = 'center';
          document.getElementById('textRotation').value = 0;
          document.getElementById('letterSpacing').value = 0;
          document.getElementById('textOpacity').value = 100;

          // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ±
          if (selectedElement.id === 'studentNameText') {
            selectedElement.style.fontSize = '28px';
          } else if (selectedElement.id === 'courseNameText') {
            selectedElement.style.fontSize = '22px';
          } else {
            selectedElement.style.fontSize = '16px';
          }

          updateControlValues(selectedElement);
        }
      });
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
    function setupExportButtons(studentName, courseName) {
      // ØªØµØ¯ÙŠØ± ÙƒØµÙˆØ±Ø© PNG
      document.getElementById('downloadCertificateBtn').addEventListener('click', exportToPNG);
      document.getElementById('exportPNG').addEventListener('click', exportToPNG);

      // ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù PDF
      document.getElementById('exportPDF').addEventListener('click', exportToPDF);

      // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒØµÙˆØ±Ø© PNG
      async function exportToPNG() {
        try {
          // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¤Ù‚ØªØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±
          const controlsPanel = document.getElementById('controlsPanel');
          controlsPanel.style.display = 'none';

          const certContent = document.getElementById('certContent');
          // Ù†Ø¶ÙŠÙ useCORS Ø­ØªÙ‰ ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø£Ùˆ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠØ©
          const canvas = await html2canvas(certContent, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: null
          });

          // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
          controlsPanel.style.display = 'block';

          const link = document.createElement('a');
          const safeName = studentName.replace(/\s+/g, '_');
          const safeCourse = courseName.replace(/\s+/g, '_');
          link.download = `${safeName}-${safeCourse}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch (err) {
          console.error(err);
          alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ù…ÙƒØªÙ…Ù„Ø© ÙˆØ£Ù† Ø§Ù„ØµÙˆØ± Ù…ØªÙˆÙØ±Ø©.');
        }
      }

      // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒÙ…Ù„Ù PDF
      async function exportToPDF() {
        try {
          // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¤Ù‚ØªØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±
          const controlsPanel = document.getElementById('controlsPanel');
          controlsPanel.style.display = 'none';

          const certContent = document.getElementById('certContent');
          const canvas = await html2canvas(certContent, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: null
          });

          // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
          controlsPanel.style.display = 'block';

          // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF({
            orientation: 'landscape',
            unit: 'mm',
            format: 'a4'
          });

          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ù…Ù„Ù PDF
          const imgData = canvas.toDataURL('image/png');
          const imgProps = pdf.getImageProperties(imgData);
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

          pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);

          // ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù PDF
          const safeName = studentName.replace(/\s+/g, '_');
          const safeCourse = courseName.replace(/\s+/g, '_');
          pdf.save(`${safeName}-${safeCourse}.pdf`);
        } catch (err) {
          console.error(err);
          alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ù…ÙƒØªÙ…Ù„Ø© ÙˆØ£Ù† Ø§Ù„ØµÙˆØ± Ù…ØªÙˆÙØ±Ø©.');
        }
      }
    }

    document.querySelector('.btn-secondary').addEventListener('click', function () {
      document.getElementById('certificateForm').reset();
      document.getElementById('emailError').textContent = '';
      document.getElementById('certificateId').value = '';
      document.getElementById('certificateOutput').style.display = 'none';
    });

    // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    document.getElementById('helpBtn').addEventListener('click', function () {
      const helpDialog = document.getElementById('helpDialog');
      helpDialog.style.display = 'block';

      // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
      document.addEventListener('click', function closeHelp(e) {
        if (!helpDialog.contains(e.target) && e.target.id !== 'helpBtn') {
          helpDialog.style.display = 'none';
          document.removeEventListener('click', closeHelp);
        }
      });
    });

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
    function applyRecommendedStyles() {
      const elements = {
        studentNameText: { fontSize: '28px', color: '#f15925' },
        instructorText: { fontSize: '16px', color: '#2f5a82' },
        hrText: { fontSize: '16px', color: '#2f5a82' },
        certIdText: { fontSize: '10px', color: '#2f5a82' },
        dateText: { fontSize: '10px', color: '#2f5a82' }
      };

      Object.entries(elements).forEach(([id, styles]) => {
        const element = document.getElementById(id);
        if (element) {
          Object.assign(element.style, styles);
          element.style.fontFamily = 'Cairo';
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© generateCertificate Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§
    const originalGenerateCertificate = window.generateCertificate;
    window.generateCertificate = function () {
      originalGenerateCertificate.apply(this, arguments);
      applyRecommendedStyles();
    };

    // Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
    function setupAlignmentGuides() {
      const certContainer = document.querySelector('.certificate-container');
      if (!certContainer) return;

      let guides = {
        vertical: [],
        horizontal: [],
        center: null
      };

      // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
      const centerGuideVertical = document.createElement('div');
      centerGuideVertical.className = 'alignment-guide vertical center';
      const centerGuideHorizontal = document.createElement('div');
      centerGuideHorizontal.className = 'alignment-guide horizontal center';

      // Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
      certContainer.appendChild(centerGuideVertical);
      certContainer.appendChild(centerGuideHorizontal);

      function updateAlignmentGuides(target) {
        const container = document.querySelector('.certificate-template');
        const containerRect = container.getBoundingClientRect();
        const targetRect = target.getBoundingClientRect();

        // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        document.querySelectorAll('.alignment-guide:not(.center)').forEach(guide => guide.remove());
        document.querySelectorAll('.alignment-guide-label').forEach(label => label.remove());

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        centerGuideVertical.style.opacity = '0';
        centerGuideHorizontal.style.opacity = '0';

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø£Ø®Ø±Ù‰
        const otherElements = Array.from(document.querySelectorAll('.draggable')).filter(el => el !== target);

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
        otherElements.forEach(other => {
          const otherRect = other.getBoundingClientRect();

          // ÙØ­Øµ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙÙ‚ÙŠØ©
          if (Math.abs(targetRect.top - otherRect.top) < 5) {
            showGuide('horizontal', targetRect.top - containerRect.top);
          }
          if (Math.abs(targetRect.bottom - otherRect.bottom) < 5) {
            showGuide('horizontal', targetRect.bottom - containerRect.top);
          }

          // ÙØ­Øµ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©
          if (Math.abs(targetRect.left - otherRect.left) < 5) {
            showGuide('vertical', targetRect.left - containerRect.left);
          }
          if (Math.abs(targetRect.right - otherRect.right) < 5) {
            showGuide('vertical', targetRect.right - containerRect.left);
          }
        });

        // ÙØ­Øµ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        const containerCenter = {
          x: containerRect.width / 2,
          y: containerRect.height / 2
        };
        const elementCenter = {
          x: targetRect.left - containerRect.left + targetRect.width / 2,
          y: targetRect.top - containerRect.top + targetRect.height / 2
        };

        if (Math.abs(elementCenter.x - containerCenter.x) < 5) {
          centerGuideVertical.style.left = containerCenter.x + 'px';
          centerGuideVertical.style.opacity = '1';
        }
        if (Math.abs(elementCenter.y - containerCenter.y) < 5) {
          centerGuideHorizontal.style.top = containerCenter.y + 'px';
          centerGuideHorizontal.style.opacity = '1';
        }
      }

      function showGuide(type, position) {
        const guide = document.createElement('div');
        guide.className = `alignment-guide ${type}`;
        guide.style[type === 'vertical' ? 'left' : 'top'] = position + 'px';
        certContainer.appendChild(guide);

        // Ø¥Ø¶Ø§ÙØ© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ø³Ø§ÙØ©
        const label = document.createElement('div');
        label.className = 'alignment-guide-label';
        label.textContent = Math.round(position) + 'px';
        label.style.position = 'absolute';
        if (type === 'vertical') {
          label.style.left = (position + 5) + 'px';
          label.style.top = '5px';
        } else {
          label.style.top = (position - 15) + 'px';
          label.style.left = '5px';
        }
        certContainer.appendChild(label);
      }

      // ØªØ­Ø¯ÙŠØ« ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ø¹Ø±Ø¶ Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
      const originalDragMoveListener = window.dragMoveListener;
      window.dragMoveListener = function (event) {
        originalDragMoveListener(event);
        updateAlignmentGuides(event.target);
      };
    }

    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© generateCertificate Ù„Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©
    const originalGenerateWithStyles = window.generateCertificate;
    window.generateCertificate = function () {
      originalGenerateWithStyles.apply(this, arguments);
      setupAlignmentGuides();
    };
  </script>


</body>

</html>